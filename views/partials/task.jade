//
   Created by lukas on 15.4.24.

div
    
    section.main-task
        h2 Task:
        
        div.task.single(
            ng-init='getTask()'
            ng-click='isCollapsed = !isCollapsed'
            style='background-color: {{task.color}}; color: {{task.textColor}}; border: 1px solid {{(task.color.toLowerCase() == "#ffffff") ? "#000000" : task.color}}'
        )
            
            h1 {{task.title}}
            
            div.progress-container
                div.progress-value {{ task.percentageDone }}%
                div.percentage-done(
                    round-progress
                    max="100"
                    current="task.percentageDone"
                    color="{{task.color}}"
                    bgcolor="{{task.textColor}}"
                    radius="45"
                    stroke="20"
                    iterations="50"
                    rounded="true"
                    animation="easeInOutQuart"
                )
                    
            div.task-info
                
                div.created-by
                    div.task-info-label Created by:
                    a(
                        href='users/{{task._createdBy.numberId}}'
                        style='color: {{task.textColor}}'
                    ) {{ task._createdBy.firstname + ' ' + task._createdBy.lastname }}
                    
                div.group(ng-if='task.group')
                    div.task-info-label Group:
                    a(
                        href='users/{{task._group.numberId}}'
                        style='color: {{task.textColor}}'
                    ) {{ task._group.title }}
                    
                div.date-created
                    div.task-info-label  Date created:
                    div.text-right {{ task.dateCreated | date : 'yyyy-MM-dd' }}
                        
                div.date-started
                    div.task-info-label  Date started:
                    div.text-right {{ task.dateStarted | date : 'yyyy-MM-dd' }}
                        
                div.date-due
                    div.task-info-label  Date due:
                    div.text-right {{ task.dateDue | date : 'yyyy-MM-dd' }}
                        
                div.date-completed(ng-if='task.status.toLowerCase() === "completed"')
                    div.task-info-label  Date completed:
                    div.text-right {{ task.dateCompleted | date : 'yyyy-MM-dd' }}
                        
                div.status
                    div.task-info-label Status:
                    div.text-right {{ task.status }}
                        
                div.quantifiable-info(ng-if='task.isQuantifiable')
                    
                    div.progress-status
                        div.task-info-label Progress:
                        div.text-right {{ task.current + '/' + task.goal }}

                    div.units
                        div.task-info-label Of:
                        div.text-right {{ task.units | capitalize}}
                
                div.auto-complete(ng-if='!(task.status.toLowerCase() === "completed")')
                    div.task-info-label Auto complete:
                    div.text-right {{ (task.autoComplete) ? "Yes" : "No" }}
                            
        
            div.task-description(
                ng-if='task.description'
                ng-bind-html='task.description | sanitize' 
                collapse='isCollapsed'
                ng-click='$event.stopPropagation()'
            )
    
    section.alerts
    
        div.alert.alert-success(
            role='alert',
            ng-if='createNewSubtaskSuccessful'
        ) Subtask successfully created!
            button.close(
                type='button'
                data-dismiss='alert'
                aria-label='close'
            )
                span(aria-hidden='true') &times;
        
        div.alert.alert-danger(
            role='alert',
            ng-if='createNewSubtaskFailed'
        ) Creating new subtask failed, please try again
            button.close(
                type='button'
                data-dismiss='alert'
                aria-label='close'
            )
                span(aria-hidden='true') &times;
        
        div.alert.alert-success(
            role='alert',
            ng-if='makeNewProgressSuccessful'
        ) Your progress was successfully submitted!
            button.close(
                type='button'
                data-dismiss='alert'
                aria-label='close'
            )
                span(aria-hidden='true') &times;
                    
        div.alert.alert-danger(
            role='alert',
            ng-if='makeNewProgressFailed'
        ) Submitting new progress failed, please try again
            button.close(
                type='button'
                data-dismiss='alert'
                aria-label='close'
            )
                span(aria-hidden='true') &times;
                
    section.commands
        div#task-commands
            
            button.btn.btn-primary.left(
                ng-click='openNewSubtaskModal(task)'
                ng-disabled='!task.availableWeight || (task.status.toLowerCase() === "completed")'
            ) Create new subtask
            button.btn.btn-primary.left(
                ng-click='openNewProgressModal(task)'
                ng-disabled='!task.availableWeight || (task.status.toLowerCase() === "completed")'
            ) Submit progress
            
            button.btn.btn-danger.right(ng-click='openDeleteConfirmationModal(task)') Delete task
            
            button.btn.btn-warning.right(
                ng-click='openEditTaskModal(task)'
                ng-disabled='task.status.toLowerCase() === "completed"'
            ) Edit task
            
            button.btn.btn-success.right(
                ng-click='openMarkAsCompleteConfirmationModal(task)'
                ng-disabled='task.status.toLowerCase() === "completed"'
            ) Mark as completed
        
    section.task-components
        div#accordion.panel-group(
            role='tablist'
            aria-multiselectable='true'
            style='margin-top: 20px'
        )
            div.panel.panel-default
                div#headingSubtasks.panel-heading(
                    role='tab'
                    data-toggle='collapse'
                    data-target='#collapseSubtasks'
                    aria-expanded='true'
                    aria-controls='collapseSubtasks'
                    style='display: block; width: 100%;'
                )
                    h3 Subtasks
                    
                div#collapseSubtasks.panel-collapse.collapse(
                    role="tabpanel" 
                    aria-labelledby="headingSubtasks"
                )
                    div.panel-body
                        
                        div.task(
                            ng-repeat='subtask in task._subtasks'
                            style='background-color: {{subtask.color}}; color: {{subtask.textColor}}; border: 1px solid {{(subtask.color.toLowerCase() == "#ffffff") ? "#000000" : subtask.color}}'
                            ng-click='openSubtask(subtask.numberId)'
                        )
                            
                            h1 {{subtask.title}}
                            
                            div.progress-container
                                
                                div.progress-value {{ subtask.percentageDone }}%
                                div.percentage-done(
                                    round-progress
                                    max="100"
                                    current="subtask.percentageDone"
                                    color="{{subtask.color}}"
                                    bgcolor="{{subtask.textColor}}"
                                    radius="45"
                                    stroke="20"
                                    iterations="50"
                                    rounded="true"
                                    animation="easeInOutQuart"
                                )
                                    
                            div.task-info
                                
                                div.created-by
                                    div.task-info-label Created by:
                                    a(
                                        href='users/{{subtask._createdBy.numberId}}'
                                        style='color: {{subtask.textColor}}'
                                    ) {{ subtask._createdBy.firstname + ' ' + subtask._createdBy.lastname }}
                                    
                                div.weight
                                    div.task-info-label  Weight:
                                    div.text-right {{ subtask.weight }}%
                                        
                                div.date-created
                                    div.task-info-label  Date created:
                                    div.text-right {{ subtask.dateCreated | date : 'yyyy-MM-dd' }}
                                        
                                div.date-started
                                    div.task-info-label  Date started:
                                    div.text-right {{ subtask.dateStarted | date : 'yyyy-MM-dd' }}
                                        
                                div.date-started
                                    div.task-info-label  Date due:
                                    div.text-right {{ subtask.dateDue | date : 'yyyy-MM-dd' }}
                                        
                                div.progress-status(ng-if='subtask.isQuantifiable')
                                    div.task-info-label Progress:
                                    div.text-right {{ subtask.current + '/' + subtask.goal }}
                                        
                                div.units(ng-if='subtask.isQuantifiable')
                                    div.task-info-label Of:
                                    div.text-right {{ subtask.units | capitalize }}
                                        
            div.panel.panel-default
                
                div#headingProgress.panel-heading(
                    role='tab'
                    data-toggle='collapse'
                    data-target='#collapseProgress'
                    aria-expanded='true'
                    aria-controls='collapseProgress'
                    style='display: block; width: 100%;'
                )
                    h3 Progress
                
                div#collapseProgress.panel-collapse.collapse(
                    role="tabpanel"
                    aria-labelledby="headingProgress"
                )
                    div.panel-body
                        div(ng-repeat='progress in task._progress')
                            {{ progress }}
                        
            div.panel.panel-default
                
                div#headingLog.panel-heading(
                    role='tab'
                    data-toggle='collapse'
                    data-target='#collapseLog'
                    aria-expanded='true'
                    aria-controls='collapseLog'
                    style='display: block; width: 100%;'
                )
                    h3 Log
                    
                div#collapseLog.panel-collapse.collapse(
                    role="tabpanel"
                    aria-labelledby="headingLog"
                )
                    div.panel-body 
                        table.table.table-condensed.table-striped.table-hover
                            thead
                                tr
                                    th Timestamp
                                    th Info
                            tbody(ng-repeat='log in task.logs')
                                tr
                                    td.date {{ log.date | date : 'yyyy-MM-dd HH:mm:ss' }}
                                    td.log-info(
                                        ng-bind-html='log.info | sanitize'
                                        style="width: 80%"
                                    )